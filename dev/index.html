<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Home · TruncatedStreams.jl</title><meta name="title" content="Home · TruncatedStreams.jl"/><meta property="og:title" content="Home · TruncatedStreams.jl"/><meta property="twitter:title" content="Home · TruncatedStreams.jl"/><meta name="description" content="Documentation for TruncatedStreams.jl."/><meta property="og:description" content="Documentation for TruncatedStreams.jl."/><meta property="twitter:description" content="Documentation for TruncatedStreams.jl."/><meta property="og:url" content="https://reallyasi9.github.io/TruncatedStreams.jl/"/><meta property="twitter:url" content="https://reallyasi9.github.io/TruncatedStreams.jl/"/><link rel="canonical" href="https://reallyasi9.github.io/TruncatedStreams.jl/"/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>TruncatedStreams.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>Home</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Home</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Home</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/reallyasi9/TruncatedStreams.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/reallyasi9/TruncatedStreams.jl/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="TruncatedStreams"><a class="docs-heading-anchor" href="#TruncatedStreams">TruncatedStreams</a><a id="TruncatedStreams-1"></a><a class="docs-heading-anchor-permalink" href="#TruncatedStreams" title="Permalink"></a></h1><p>Documentation for <a href="https://github.com/reallyasi9/TruncatedStreams.jl">TruncatedStreams</a>.</p><ul><li><a href="#TruncatedStreams.FixedLengthSource"><code>TruncatedStreams.FixedLengthSource</code></a></li><li><a href="#TruncatedStreams.SentinelizedSource"><code>TruncatedStreams.SentinelizedSource</code></a></li><li><a href="#TruncatedStreams.TruncatedSource"><code>TruncatedStreams.TruncatedSource</code></a></li><li><a href="#TruncatedStreams.unwrap"><code>TruncatedStreams.unwrap</code></a></li></ul><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TruncatedStreams.FixedLengthSource" href="#TruncatedStreams.FixedLengthSource"><code>TruncatedStreams.FixedLengthSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">FixedLengthSource(io, length) &lt;: TruncatedSource</code></pre><p>A truncated source that reads <code>io</code> up to <code>length</code> bytes.</p><pre><code class="language-julia-repl hljs">julia&gt; io = IOBuffer(collect(0x00:0xff));

julia&gt; fio = FixedLengthSource(io, 10);

julia&gt; read(fio)
10-element Vector{UInt8}:
 0x00
 0x01
 0x02
 0x03
 0x04
 0x05
 0x06
 0x07
 0x08
 0x09

julia&gt; eof(fio)
true</code></pre><p>As soon as a read from a <code>FixedLengthSource</code> object would read past <code>length</code> bytes of the underlying IO stream, EOF is signalled, potentially leading to an <code>EOFError</code> being thrown.</p><pre><code class="language-julia-repl hljs">julia&gt; read(fio, Int)
ERROR: EOFError: read end of file
[...]</code></pre><p>Seeking does not affect the length at which the stream is truncated, but may affect how many bytes are available to read.</p><pre><code class="language-julia-repl hljs">julia&gt; seek(fio, 8); read(fio)
2-element Vector{UInt8}:
 0x08
 0x09</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/reallyasi9/TruncatedStreams.jl/blob/78ab0ab3d8e1d1d69855216b8f7ea83eb70e8d3e/src/fixedlength.jl#L1-L46">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TruncatedStreams.SentinelizedSource" href="#TruncatedStreams.SentinelizedSource"><code>TruncatedStreams.SentinelizedSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">SentinelizedSource(io, sentinel) &lt;: TruncatedSource</code></pre><p>A truncated source that reads <code>io</code> until <code>sentinel</code> is found.</p><pre><code class="language-julia-repl hljs">julia&gt; io = IOBuffer(repeat(collect(0x00:0x0f), 2));

julia&gt; sio = SentinelizedSource(io, [0x0a, 0x0b]);

julia&gt; read(sio)
10-element Vector{UInt8}:
 0x00
 0x01
 0x02
 0x03
 0x04
 0x05
 0x06
 0x07
 0x08
 0x09

julia&gt; eof(sio)
true</code></pre><p>As soon as a read from a <code>SentinelizedSource</code> object would read the start of a byte sequence matching <code>sentinel</code> from the underlying IO stream, EOF is signalled, potentially leading to an <code>EOFError</code> being thrown.</p><pre><code class="language-julia-repl hljs">julia&gt; read(sio, Int)
ERROR: EOFError: read end of file
[...]</code></pre><p>Seeking works as if the stream ends at the first byte of the sentinel: backwards seeking will always succeed if the wrapped stream allows it, and forward seeking will only seek up to the sentinel. Note that forward seeking will consume bytes from the wrapped stream.</p><pre><code class="language-julia-repl hljs">julia&gt; seek(sio, 8); read(sio)
2-element Vector{UInt8}:
 0x08
 0x09</code></pre><p>Detection of eof can be reset with the <code>Base.reseteof()</code> method. Use this if the sentinel that was read is determined upon further inspection to be bogus.</p><pre><code class="language-julia-repl hljs">julia&gt; Base.reseteof(sio)  # that last sentinel was fake, so reset EOF and read again

julia&gt; read(sio)  # returns the first sentinel found and continues to read until the next one is found
16-element Vector{UInt8}:
 0x0a
 0x0b
 0x0c
 0x0d
 0x0e
 0x0f
 0x00
 0x01
 0x02
 0x03
 0x04
 0x05
 0x06
 0x07
 0x08
 0x09</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If the wrapped stream does not contain a sentinel, reading to the end of the stream will throw <code>EOFError</code>.</p></div></div><pre><code class="language-julia-repl hljs">julia&gt; io = IOBuffer(collect(0x00:0x07)); sio = SentinelizedSource(io, [0xff, 0xfe]);

julia&gt; read(sio)
ERROR: EOFError: read end of file
[...]</code></pre></div><a class="docs-sourcelink" target="_blank" href="https://github.com/reallyasi9/TruncatedStreams.jl/blob/78ab0ab3d8e1d1d69855216b8f7ea83eb70e8d3e/src/sentinel.jl#L1-L86">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TruncatedStreams.TruncatedSource" href="#TruncatedStreams.TruncatedSource"><code>TruncatedStreams.TruncatedSource</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">TruncatedSource &lt;: IO</code></pre><p>Wrap an IO object to read only as much as should be read and not a byte more.</p><p>Objects inheriting from this abstract type pass along all read-oriented IO methods to the wrapped stream except for <code>bytesavailable(io)</code> and <code>eof(io)</code>. Inherited types <em>must</em> implement:</p><ul><li><code>TruncatedStreams.unwrap(::TruncatedSource)::IO</code>: return the wrapped IO stream.</li><li><code>Base.eof(::TruncatedSource)::Bool</code>: report whether the stream cannot produce any more bytes.</li></ul><p>In order to implement truncation, some number of these methods will likely need to be implemented:</p><ul><li><code>Base.unsafe_read(::TruncatedSource, p::Ptr{UInt8}, n::UInt)::Nothing</code>: copy <code>n</code> bytes from the   stream into memory pointed to by <code>p</code>.</li><li><code>Base.read(::TruncatedSource, T::Type)::T</code>: read and return an object of type <code>T</code> from the stream.</li><li><code>Base.bytesavailable(::TruncatedSource)::Int</code>: report the number of bytes available to read from   the stream until EOF or a buffer refill is necessary.</li><li><code>Base.seek(::TruncatedSource, p::Integer)</code> and <code>Base.seekend(::TruncatedSource)</code>: seek stream to   position <code>p</code> or end of stream.</li><li><code>Base.reset(::TruncatedSource)</code>: reset a marked stream to the saved position.</li><li><code>Base.reseteof(::TruncatedSource)::Nothing</code>: reset EOF status.</li><li><code>Base.peek(::TruncatedSource[, T::Type])::T</code>: read and return the next object of type <code>T</code> from the   stream, but leave the bytes available in the stream for the next read.</li></ul><p>The following methods <em>must</em> be implemented by the wrapped IO type for all the functionality of the     <code>TruncatedSource</code> to work at all:</p><ul><li><code>Base.eof(::IO)::Bool</code></li><li><code>Base.read(::IO, ::Type{UInt8})::UInt8</code></li></ul><p>The wrapped stream also must implement <code>Base.seek</code> and <code>Base.skip</code> for seeking and skipping of the truncated stream to work properly. Additionally, <code>Base.position</code> needs to be implemented for some implementations of <code>Base.seek</code> to work properly.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/reallyasi9/TruncatedStreams.jl/blob/78ab0ab3d8e1d1d69855216b8f7ea83eb70e8d3e/src/io.jl#L1-L32">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="TruncatedStreams.unwrap" href="#TruncatedStreams.unwrap"><code>TruncatedStreams.unwrap</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">unwrap(s&lt;:TruncatedSource{T}) -&gt; T where {T &lt;: IO}</code></pre><p>Return the wrapped source.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/reallyasi9/TruncatedStreams.jl/blob/78ab0ab3d8e1d1d69855216b8f7ea83eb70e8d3e/src/io.jl#L36-L40">source</a></section></article></article><nav class="docs-footer"><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.7.0 on <span class="colophon-date" title="Tuesday 1 October 2024 15:13">Tuesday 1 October 2024</span>. Using Julia version 1.10.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
